[supervisord]
nodaemon=true
logfile=/workspace/logs/supervisord.log
pidfile=/var/run/supervisord.pid

[program:nginx]
command=/usr/sbin/nginx -g 'daemon off;'
autostart=true
autorestart=true
stderr_logfile=/workspace/logs/nginx-error.log
stdout_logfile=/workspace/logs/nginx-access.log
priority=10

[program:frontend]
command=sh -c 'cd /workspace/frontend && python3 -m http.server 3000'
autostart=true
autorestart=true
stderr_logfile=/workspace/logs/frontend-error.log
stdout_logfile=/workspace/logs/frontend-access.log
priority=20

[program:backend]
command=sh -c 'if [ -f /workspace/backend/server.py ]; then cd /workspace/backend && uvicorn server:app --host 0.0.0.0 --port 8001 --reload; else echo "No backend"; sleep infinity; fi'
autostart=true
autorestart=true
stderr_logfile=/workspace/logs/backend-error.log
stdout_logfile=/workspace/logs/backend-access.log
priority=30
